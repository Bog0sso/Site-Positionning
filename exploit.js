const geo = require("haversine-distance");
const fs=require('fs');
let siteInformations=require('./Site.json');
// The Site.json file is an array of {"Site":"VALUE","Population":"VALUE","Lon":"VALUE","Lat":"VALUE"}
const size=siteInformations.length;
let max_distance_8KM=[];

for (let i = 0; i < size; i++) {
    for (let j = 0; j < size; j++) {
        if(i!=j){
            const site1={lat:siteInformations[i].Lat,lng:siteInformations[i].Lon}
            const site2={lat:siteInformations[j].Lat,lng:siteInformations[j].Lon}
            let distance=geo(site1,site2);
            distance=distance/1000;
            let max_population=siteInformations[i].Population;
            if(distance < 8 ) {
                max_population=siteInformations[i].Population > siteInformations[j].Population ? siteInformations[i]:siteInformations[j];
                max_distance_8KM.push(max_population);
            }else if(distance >=8){
                max_distance_8KM.push(siteInformations[i]);
            }
        }
    }
    
}

const uniqueSites = [...new Set(max_distance_8KM)];

for (const element of uniqueSites) {
    let string=JSON.stringify(element);
    string+=', ';
    fs.appendFile('./output.json',string, err => {
        if(err)
            console.error(err);
        console.log(string)
    }); //APPEND TO FILE
}